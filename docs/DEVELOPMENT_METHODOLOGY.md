# 债权审查系统工程化改造开发方法论

**项目**: 债权审查系统 (Debt Review System)
**创建日期**: 2025-11-30
**目的**: 记录从Claude Code Agent方案迁移到LangGraph工程化方案的开发方法论

---

## 一、核心开发理念

### 1.1 质量基准驱动开发 (Benchmark-Driven Development)

**核心思想**: 以原方案（Claude Code Agent）的高质量输出作为基准，通过持续对比分析，迭代优化工程化方案，直至达到同等或更高质量。

**执行流程**:
```
原方案输出 (Ground Truth)
       ↓
    对比分析
       ↓
  识别质量差距
       ↓
    分类定级
       ↓
  制定改进计划
       ↓
    实施修复
       ↓
    验证测试
       ↓
  更新基准对比
       ↓
    循环迭代
```

### 1.2 问题分级机制

| 级别 | 标识 | 描述 | 处理优先级 |
|------|------|------|------------|
| P0 | 🔴 紧急 | 影响计算准确性、法律合规性的核心问题 | 必须立即修复 |
| P1 | 🟡 高优 | 影响报告质量、完整性的重要问题 | 优先修复 |
| P2 | 🟢 中优 | 影响用户体验、工作效率的改进项 | 计划改进 |
| P3 | ⚪ 低优 | 美化、优化类需求 | 有余力时处理 |

---

## 二、对比分析方法

### 2.1 多维度质量评估框架

对每个债权人案例，从以下维度进行评估：

#### 2.1.1 计算准确性维度
- 利息计算结果是否正确
- 日期推定逻辑是否合理
- 就低原则/就无原则是否正确应用
- 债权分类是否正确（优先/普通/劣后）

#### 2.1.2 报告完整性维度
- 必要章节是否齐全
- 关键信息是否遗漏
- 时间线是否完整
- 证据引用是否充分

#### 2.1.3 报告深度维度
- 分析论证是否充分
- 法律依据是否明确
- 计算过程是否详细
- 结论是否有说服力

#### 2.1.4 格式规范维度
- 是否符合法律文书规范
- 术语使用是否准确
- 格式是否统一
- 是否便于后续使用

### 2.2 量化对比指标

```
达标率 = 工程化方案指标值 / 原方案指标值 × 100%

具体指标：
- 报告字符数达标率
- 必要章节覆盖率
- 计算准确率
- 关键信息提取率
```

### 2.3 对比分析模板

对每个案例，按以下模板进行对比：

```markdown
## 案例：[债权人名称]

### 1. 基本信息对比
| 项目 | 原方案 | 工程化方案 | 差异 |
|------|--------|------------|------|
| ... | ... | ... | ... |

### 2. 计算结果对比
| 计算项 | 原方案结果 | 工程化结果 | 差异 | 是否正确 |
|--------|------------|------------|------|----------|
| ... | ... | ... | ... | ... |

### 3. 报告质量对比
| 维度 | 原方案 | 工程化方案 | 达标率 |
|------|--------|------------|--------|
| ... | ... | ... | ... |

### 4. 发现的问题
- P0: ...
- P1: ...
- P2: ...

### 5. 改进建议
- ...
```

---

## 三、迭代改进流程

### 3.1 单案例改进循环

```
Step 1: 读取原方案输出
Step 2: 运行工程化方案
Step 3: 对比分析差距
Step 4: 识别问题根因
Step 5: 制定修复方案
Step 6: 实施代码修改
Step 7: 重新运行测试
Step 8: 验证修复效果
Step 9: 更新跟踪文档
```

### 3.2 多案例泛化改进

当收到新的参照案例时：

```
Step 1: 分析新案例特点
        - 债权类型（有无判决/调解/仲裁）
        - 计算复杂度（单笔/多笔利息）
        - 特殊情况（担保/时效/执行）

Step 2: 运行工程化方案
        - 使用当前版本处理

Step 3: 对比原方案输出
        - 按多维度评估框架对比

Step 4: 识别共性问题
        - 是否为已知问题的变体
        - 是否为新类型问题

Step 5: 优化Prompt或代码
        - 针对新问题类型增强
        - 确保不影响已解决的问题

Step 6: 回归测试
        - 验证新案例
        - 验证历史案例（防止回退）

Step 7: 更新知识库
        - 总结新的处理规则
        - 更新Prompt模板
```

---

## 四、关键技术点记录

### 4.1 利息计算规则

| 类型 | 计算方法 | 法律依据 |
|------|----------|----------|
| LPR浮动利率 | 本金 × LPR × 倍数 × 天数/365 | 合同约定 |
| 迟延履行利息 | 本金 × 0.000175 × 天数 | 民诉法260条 |
| 简单利率 | 本金 × 年利率 × 天数/365 | 合同约定 |

### 4.2 日期推定规则

| 情形 | 推定方法 |
|------|----------|
| 一审判决生效 | 判决日 + 15天上诉期 |
| 二审判决生效 | 作出日即生效 |
| 调解书生效 | 签收日生效 |
| 履行期限届满 | 生效日 + 履行期限 |
| 迟延利息起算 | 履行期限届满次日 |
| 利息止息日 | 破产受理日前一日 |

### 4.3 金额确认原则

| 原则 | 适用情形 | 处理方法 |
|------|----------|----------|
| 就低原则 | 计算值 vs 申报值 | 取较低者 |
| 就无原则 | 未申报项目 | 不予确认 |
| 就高原则 | 特定担保情形 | 取较高者（罕见）|

### 4.4 债权分类规则

| 类型 | 判断依据 | 清偿顺序 |
|------|----------|----------|
| 优先债权 | 有物权担保/法定优先权 | 最先 |
| 普通债权 | 本金、合同利息、诉讼费等 | 其次 |
| 劣后债权 | 迟延履行利息、罚息等 | 最后 |

---

## 五、Prompt优化经验

### 5.1 事实核查报告Prompt

**关键要素**:
- 6类时间线事件清单
- 证据材料逐字摘录要求
- 债权发生情况表格格式
- 证据效力层级说明

### 5.2 债权分析报告Prompt

**关键要素**:
- 8章标准结构
- 利息计算标记格式（供系统解析）
- 判决生效日期推定规则
- 详细的计算参数格式

### 5.3 最终报告Prompt

**关键要素**:
- 7章完整结构（匹配原方案）
- 管理人审查结论模板
- 计算结果汇总表格式
- 差异说明要求

---

## 六、持续改进机制

### 6.1 案例库建设

```
/参照案例库/
├── 1-上海牧诚贸易有限公司/     # 买卖合同纠纷（有判决）
├── 2-XXX公司/                   # [待添加]
├── 3-XXX公司/                   # [待添加]
└── ...
```

每个案例包含：
- 原方案输出（Ground Truth）
- 工程化方案输出（当前版本）
- 对比分析报告
- 改进记录

### 6.2 回归测试机制

每次修改后，对所有案例库进行回归测试：

```bash
# 回归测试脚本
python tests/regression_test.py --all-cases
```

验证项：
- 计算准确性
- 报告完整性
- 无回退问题

### 6.3 版本迭代记录

| 版本 | 日期 | 主要改进 | 达标率变化 |
|------|------|----------|------------|
| v1.0 | 2025-11-30 | 初始版本 | 60-70% |
| v2.0 | 2025-11-30 | P0修复完成 | 85%+ |
| v2.1 | ... | ... | ... |

---

## 七、文档维护

### 7.1 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 改进追踪 | `docs/IMPROVEMENT_TRACKER.md` | 具体改进进度 |
| 迁移指南 | `docs/LANGGRAPH_MIGRATION_GUIDE.md` | 技术实现细节 |
| 方法论 | `docs/DEVELOPMENT_METHODOLOGY.md` | 本文档 |

### 7.2 更新频率

- **IMPROVEMENT_TRACKER.md**: 每次修改后更新
- **DEVELOPMENT_METHODOLOGY.md**: 发现新方法/规则时更新
- **案例对比报告**: 每个新案例添加时创建

---

## 八、接收新案例的标准流程

当用户提供新的原方案输出案例时，执行以下流程：

```
1. 读取原方案输出
   - 事实核查报告
   - 债权分析报告
   - 最终审查报告
   - 计算文件

2. 提取关键指标
   - 债权人名称
   - 申报金额明细
   - 确认金额明细
   - 关键日期
   - 特殊情况

3. 运行工程化方案
   - 使用相同输入材料
   - 生成三份报告

4. 执行对比分析
   - 计算准确性
   - 报告完整性
   - 发现差距

5. 更新改进计划
   - 记录新发现的问题
   - 制定修复方案

6. 实施并验证
   - 修改代码/Prompt
   - 回归测试

7. 更新文档
   - IMPROVEMENT_TRACKER.md
   - 案例对比报告
```

---

**文档版本**: v1.0
**最后更新**: 2025-11-30
**维护者**: Claude
