# Agent模板化报告撰写实践指南

**基于债权审查项目的成功经验总结**
**版本**: v1.0
**更新日期**: 2025-11-10

---

## 一、核心挑战与解决方案

### 1.1 核心挑战

**问题**: AI Agent在撰写最终报告时容易使用Markdown语法（标题、列表、粗体），导致输出格式不符合正式文档要求。

**影响**:
- 客户交付物格式不专业
- 需要大量人工修改
- 降低自动化效率

### 1.2 解决方案架构

```
输入材料 → Agent处理 → 格式验证 → 通过/重新生成 → 交付物
                ↓
           模板约束层
         (三重保障机制)
```

**三重保障机制**:
1. **事前约束**: Agent指令中明确禁止Markdown语法
2. **过程控制**: 提供纯文本格式模板参考
3. **事后验证**: 自动化格式检查（零容忍标准）

---

## 二、格式控制核心方法

### 2.1 明确禁止项（Agent指令）

```markdown
**FORMAT REQUIREMENTS (ZERO TOLERANCE):**
❌ NO Markdown headings (##)
❌ NO bullet lists (-)
❌ NO bold syntax (**)
✅ Plain text paragraphs with complete sentences
✅ Chapter titles: "一、二、三..." (NOT "## 一、")
```

### 2.2 自动化验证（零容忍检查）

```bash
# 三项必检
grep -q "^##" "$REPORT"    # 检查Markdown标题
grep -q "^- " "$REPORT"    # 检查列表标记
grep -q "\*\*" "$REPORT"   # 检查粗体语法

# 期望结果: 全部为空（无匹配）
```

### 2.3 失败重做（不手工修复）

```
验证失败 → 报告问题 → Agent重新生成 → 再次验证
```

---

## 三、关键成功因素

### 3.1 明确性原则

❌ **错误做法**: "请使用正式格式"
✅ **正确做法**: "禁止使用## ## - **语法，使用'一、二、三...'作为章节标题"

### 3.2 验证性原则

❌ **错误做法**: 依赖Agent自我检查
✅ **正确做法**: 用grep等工具自动验证，零容忍标准

### 3.3 迭代性原则

❌ **错误做法**: 验证失败后手工修改
✅ **正确做法**: 自动触发重新生成，保持自动化完整性

---

## 四、快速参考模板

### 4.1 Agent指令模板

```markdown
You are the report-organizer agent.

**FORMAT REQUIREMENTS (CRITICAL - ZERO TOLERANCE):**
❌ NO Markdown headings (##) → Use "一、二、三..."
❌ NO bullet lists (-)      → Use complete sentences
❌ NO bold syntax (**)      → Use plain text

**MANDATORY VERIFICATION:**
After generation, check:
1. grep -q "^##" [file]  → Must return empty
2. grep -q "^- " [file]  → Must return empty
3. grep -q "\*\*" [file] → Must return empty

If ANY check fails: STOP and regenerate.
```

### 4.2 验证脚本模板

```bash
#!/bin/bash
# format_check.sh

REPORT="$1"
ERRORS=0

echo "格式验证: $(basename "$REPORT")"

if grep -q "^##" "$REPORT"; then
    echo "❌ 发现Markdown标题"
    ERRORS=$((ERRORS + 1))
fi

if grep -q "^- " "$REPORT"; then
    echo "❌ 发现列表标记"
    ERRORS=$((ERRORS + 1))
fi

if grep -q "\*\*" "$REPORT"; then
    echo "❌ 发现粗体语法"
    ERRORS=$((ERRORS + 1))
fi

if [ $ERRORS -eq 0 ]; then
    echo "✅ 格式验证通过"
    exit 0
else
    echo "❌ 格式验证失败 ($ERRORS 项)"
    exit 1
fi
```

---

## 五、常见问题速查

### Q1: Agent仍生成Markdown怎么办？

**A**: 在指令中加入示例对比：

```markdown
CORRECT EXAMPLE:
一、债权申报情况
债权人XXX向管理人申报...（段落）

INCORRECT EXAMPLE (FORBIDDEN):
## 一、债权申报情况
- 债权人: XXX
- 金额: **XXX元**
```

### Q2: 如何处理需要列表的内容？

**A**: 转为叙述性段落：

```
❌ 证据包括:
   - 合同3份
   - 发票15份

✅ 证据包括合同3份、发票15份。
```

### Q3: 验证产生误报怎么办？

**A**: 优化正则表达式：

```bash
# 避免日期误报
grep -q "^-[[:space:]][^0-9]" "$REPORT"
```

---

## 六、本项目实践成果

**第6批债权处理结果**:
- 债权人数: 6个
- 格式合规率: **100%** (6/6)
- Markdown违规: **0个**
- 平均节省时间: 15-20分钟/报告

**验证通过率**:
```
✅ Markdown标题检查: 0个违规
✅ 列表标记检查: 0个违规  
✅ 粗体语法检查: 0个违规
```

---

## 七、核心记忆点

> **"三禁止、三必须"**
>
> **禁止**: ## 标题、- 列表、** 粗体
> **必须**: 明确指令、自动验证、失败重做

**成功公式**:

```
成功率 = 明确指令 × 自动验证 × 失败重试
       ─────────────────────────────
            人工干预最小化
```

---

## 八、实施步骤清单

**准备阶段** (5分钟):
```
□ 创建纯文本模板文件
□ 编写格式验证脚本
□ 测试验证脚本
```

**执行阶段** (自动化):
```
□ 调用Agent（使用标准指令）
□ 执行格式验证
□ 通过 → 下一个；失败 → 重新生成
```

**验收阶段** (2分钟):
```
□ 批量验证所有报告
□ 抽查内容准确性
□ 确认交付标准
```

---

## 九、适用场景

本方法适用于所有需要Agent按模板生成正式文档的场景：

1. **法律文书**: 合同、协议、法律意见书
2. **审计报告**: 财务审计、内控审计报告
3. **技术文档**: 需求、设计、测试报告
4. **公文写作**: 请示、报告、通知
5. **学术论文**: 严格格式的论文初稿

**共同特征**:
- 有明确格式规范
- 需要正式文档风格
- 要求内容准确性
- 追求自动化效率

---

**文档版本**: v1.0
**来源项目**: 债权审查三agent协作系统
**实战验证**: 6个债权人，100%格式合规
**建议用法**: 首次阅读全文，后续参考第四节快速模板

---

## 附录：本项目关键配置示例

### CLAUDE.md中的格式要求

```markdown
**Checkpoint 3: After Organizer (MUST PASS before completion)**

**Format Compliance Verification (CRITICAL - Zero Tolerance)**:

MANDATORY: Execute automated format checks on final report

```bash
# Check 1: No Markdown heading syntax
grep -n "^##" "$FINAL_REPORT"
# Expected: Empty output

# Check 2: No bullet list markers  
grep -n "^- " "$FINAL_REPORT"
# Expected: Empty output

# Check 3: No bold/italic syntax
grep -n "\*\*" "$FINAL_REPORT"
# Expected: Empty output
```

Failure Protocol:
IF any format check fails:
  → STOP immediately
  → Report specific violations
  → Regenerate with explicit format conversion
  → Re-run ALL format checks
  → DO NOT proceed until all checks pass
```

### report-organizer agent指令示例

```markdown
**MANDATORY TASKS:**
7. Verify format compliance (NO markdown syntax)

**Format Compliance Verification (CRITICAL - Zero Tolerance)**:
Execute automated format checks before declaring completion.
NO Markdown syntax allowed in final report.
```

---

**使用本指南后的预期效果**:
- ✅ 格式合规率 ≥ 95%
- ✅ 人工修改时间减少 80%+
- ✅ 交付物质量稳定
- ✅ 自动化流程完整

