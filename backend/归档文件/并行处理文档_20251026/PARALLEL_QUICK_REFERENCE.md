# 并行处理快速参考卡
# Parallel Processing Quick Reference Card

**版本**: 1.0 | **日期**: 2025-10-26 | **打印友好格式**

---

## 🚦 快速决策：何时使用并行？

```
债权人数量 ≥ 3  且  同一阶段  →  ✅ 使用并行
债权人数量 = 1-2               →  ❌ 使用串行（无效率提升）
跨阶段处理同一债权人            →  ❌ 严格禁止
```

**预期效率提升**:
- 3个债权人: ~60% 时间节省
- 5个债权人: ~75% 时间节省
- 10个债权人: ~80% 时间节省（建议分批）

---

## ✈️ 起飞前检查清单（Pre-Flight Checklist）

在启动任何并行处理前：

```
□ 所有债权人已完成环境初始化（.processing_config.json 存在）
□ project_config.ini 中破产日期正确
□ 输入材料文件齐全（输入/第X批债权/*.md）
□ 债权人数量合理（推荐 2-8 个，最多 15 个）
□ Claude Code 权限配置为 "allow": ["Bash"]
```

**一键验证**:
```bash
# 检查配置文件数量
find 输出/第X批债权 -name ".processing_config.json" | wc -l
# 结果应等于债权人数量

# 检查输入材料
ls -lh 输入/第X批债权/*.md
```

---

## 🎯 三阶段并行处理核心命令

### 阶段 0: 批量初始化（串行，必须先完成）

```bash
# 逐个初始化（或使用循环）
python 债权处理工作流控制器.py 1 115 慈溪市东航建筑起重机械安装队
python 债权处理工作流控制器.py 1 118 宁波市江北朗威机电技术有限公司
# ... 其他债权人
```

### 阶段 1: 事实核查（并行）

**向 Claude Code 发送**:
```
我要并行处理第[X]批债权的[N]个债权人的事实核查阶段。
请使用[N]个独立的 debt-fact-checker agent 实例。

[然后在一个消息中使用 Task 工具 N 次]
```

**Prompt 模板**: `parallel_prompt_templates/stage1_fact_checking_parallel_template.md`

**质量检查点**: 完成后执行 `PARALLEL_QUALITY_CHECKLIST.md` 的 Checkpoint 1

### 阶段 2: 债权分析（并行）

**向 Claude Code 发送**:
```
我要并行处理第[X]批债权的[N]个债权人的债权分析阶段。
请使用[N]个独立的 debt-claim-analyzer agent 实例。

[然后在一个消息中使用 Task 工具 N 次]
```

**Prompt 模板**: `parallel_prompt_templates/stage2_debt_analysis_parallel_template.md`

**质量检查点**: 完成后执行 Checkpoint 2

### 阶段 3: 报告整理（并行）

**向 Claude Code 发送**:
```
我要并行处理第[X]批债权的[N]个债权人的报告整理阶段。
请使用[N]个独立的 report-organizer agent 实例。

[然后在一个消息中使用 Task 工具 N 次]
```

**Prompt 模板**: `parallel_prompt_templates/stage3_report_organization_parallel_template.md`

**质量检查点**: 完成后执行 Checkpoint 3 + Final Acceptance

---

## 🛡️ 防污染三原则（Zero Tolerance）

### 原则 1: 完全自包含的 Prompt
```
✅ 每个 prompt 包含：
   - 债权人完整身份（批次、编号、名称）
   - 所有必需路径（绝对路径）
   - 破产日期等关键参数
   - 独立验证指令

❌ 不依赖：
   - 外部上下文
   - 其他债权人信息
   - 隐式假设
```

### 原则 2: 三层验证机制
```
第一层（启动验证）: 读取配置文件验证身份
第二层（过程验证）: 每次文件操作验证路径
第三层（完成验证）: 输出前检查债权人信息一致性
```

### 原则 3: 失败隔离
```
债权人 A 失败 → 不影响债权人 B, C, D, E
仅重新处理失败者，成功者结果保留
```

---

## ⚡ 质量检查速查（每阶段必做）

### 文件存在性检查（100%）
```bash
# 阶段1后：检查事实核查报告
ls 输出/第X批债权/*/工作底稿/*事实核查报告.md

# 阶段2后：检查债权分析报告
ls 输出/第X批债权/*/工作底稿/*债权分析报告.md

# 阶段3后：检查审查意见表
ls 输出/第X批债权/*/最终报告/GY2025_*.md
```

### 独立性抽查（零容忍）
```bash
# 在债权人A的报告中搜索债权人B的名称
grep "债权人B名称" 输出/第X批债权/[编号A]-[债权人A]/工作底稿/*.md
# 应无结果（如有结果 = 上下文污染）
```

### 日期一致性检查（零容忍）
```bash
# 检查所有报告的破产受理日期
grep -r "破产受理日期" 输出/第X批债权/*/工作底稿/*.md
# 所有结果必须相同
```

---

## 🚨 常见问题快速修复

### 问题 1: 某个债权人失败
```
处理步骤:
1. 保留成功债权人的结果（不重新处理）
2. 分析失败原因（检查错误日志）
3. 修复问题（配置/路径/材料）
4. 仅重新处理失败者（单独串行）
5. 整合到批次结果
```

### 问题 2: 发现上下文污染
```
处理步骤（强制）:
1. 立即停止所有处理
2. 删除污染债权人的所有输出
3. 重新初始化环境
4. 使用串行模式重新处理
5. 深度验证独立性
6. 报告污染原因
```

### 问题 3: 日期不一致
```
处理步骤:
1. 停止处理
2. 确认 project_config.ini 中的日期是否正确
3. 重新初始化所有债权人（使用正确日期）
4. 删除错误日期的所有输出
5. 从阶段0重新开始
```

### 问题 4: 3+ 个债权人同时失败
```
处理步骤:
1. 立即停止并行
2. 分析系统性问题（prompt模板/配置/系统bug）
3. 修复根本原因
4. 决策：问题简单 → 重新并行
        问题复杂 → 回退串行
```

---

## 📋 Prompt 生成工具（推荐使用）

### 自动生成 Prompt（避免手动错误）

```bash
# 生成阶段1的所有 prompt
python parallel_prompt_generator.py \
  --stage 1 \
  --batch 1 \
  --creditors 115,118,124,134,140

# 生成阶段2的所有 prompt
python parallel_prompt_generator.py \
  --stage 2 \
  --batch 1 \
  --creditors 115,118,124,134,140

# 生成阶段3的所有 prompt
python parallel_prompt_generator.py \
  --stage 3 \
  --batch 1 \
  --creditors 115,118,124,134,140
```

**输出**: 自动替换所有占位符，生成可直接使用的完整 prompt

---

## 🎓 关键记忆点（Critical Reminders）

### ✅ 务必做到：
- 每个阶段完成后执行质量检查
- 使用绝对路径（从 /root/debt_review_skills 开始）
- 等待所有债权人完成当前阶段再进入下一阶段
- 记录所有 Task 调用在一个消息中发起
- 使用 prompt generator 避免手动错误

### ❌ 绝对禁止：
- 跨阶段并行（同一债权人同时处理多个阶段）
- 跳过质量检查点
- 部分债权人完成就进入下一阶段
- 使用相对路径
- 手动拼接 prompt（容易出错）

---

## 📊 性能数据参考

| 债权人数量 | 串行耗时 | 并行耗时 | 时间节省 | 效率提升 |
|-----------|---------|---------|---------|---------|
| 1个       | 16分钟   | 16分钟   | 0分钟    | 0%      |
| 3个       | 48分钟   | 20分钟   | 28分钟   | 58%     |
| 5个       | 80分钟   | 18分钟   | 62分钟   | 78%     |
| 10个      | 160分钟  | 30分钟   | 130分钟  | 81%     |

**注**: 实际耗时取决于债权复杂度、材料页数、计算项数量

---

## 🔗 完整文档参考

- **技术协议**: `PARALLEL_PROCESSING_PROTOCOL.md`
- **质量检查**: `PARALLEL_QUALITY_CHECKLIST.md`
- **用户手册**: `PARALLEL_PROCESSING_USER_GUIDE.md`
- **标准流程**: `PARALLEL_PROCESSING_SOP.md`
- **系统指南**: `CLAUDE.md` - Part 11: Parallel Processing Modes

---

## 📞 求助决策树

```
遇到问题？
    ├─ 单个债权人失败 → 参考"问题1"快速修复
    ├─ 上下文污染 → 参考"问题2"强制处理流程
    ├─ 日期不一致 → 参考"问题3"重新初始化
    ├─ 系统性失败 → 参考"问题4"分析根本原因
    ├─ Prompt 不知如何写 → 使用 parallel_prompt_generator.py
    ├─ 质量检查不知怎么做 → 参考 PARALLEL_QUALITY_CHECKLIST.md
    └─ 流程不清楚 → 参考 PARALLEL_PROCESSING_USER_GUIDE.md
```

---

**打印提示**: 建议打印此页面并在并行处理时放在手边作为快速参考

**版本历史**:
- v1.0 (2025-10-26): 初始版本
